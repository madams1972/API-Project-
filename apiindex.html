<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://code.jquery.com/jquery-3.6.1.min.js"
        integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ=" crossorigin="anonymous"></script>
    <link href="https://unpkg.com/tailwindcss@^2/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="Asset/style.css">
    <title>API Test</title>
</head>

<body>
    <header>
        <form id="mapbox_form" style="display:flex;justify-content:flex-start;">
            <input id="mapbox_search" type="text" style="margin-right: 10px;" class="placeholder-gray-500 border"
                placeholder="Enter your destination">
            <button class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">Let's Camp!</button>
        </form>
        <!-- <form id="nps_form" style="display:flex;justify-content:flex-start;">
      <div style="margin-right: 10px">Enter a state code:</div>
      <input id="nps_search" type="text" style="margin-right: 10px;">
      <button id="submit">Submit</button>
    </form> -->
        <!-- <img src = "Asset/Trees.webp" class ="w-full h-1/6"> -->
    </header>
    <main id="results" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6 w-full">
        <ul>
            <li><strong>Aspenglen Campground</strong>
                <br><display: none Latitude: 40.39934770583215>
                <br><display: none Latitude: Longitude: -105.59305451637942>
                <br>
                <img height="75"
                    src="https://www.nps.gov/common/uploads/structured_data/3FAA6E89-1DD8-B71B-0B170E56BD4ED00D.jpg">
            </li>
            <li>Glacier Basin Campground<br>Latitude: 40.32980715336969<br>Longitude: -105.59562927944023<br><img
                    height="75"
                    src="https://www.nps.gov/common/uploads/structured_data/B51D1028-1DD8-B71B-0BD70D7C96AD7D46.jpg">
            </li>
            <li>Longs Peak Campground<br>Latitude: 40.27479364272779<br>Longitude: -105.55770432202075<br><img
                    height="75"
                    src="https://www.nps.gov/common/uploads/structured_data/B54D7D43-1DD8-B71B-0B10C6B6EAD958DB.jpg">
            </li>
            <li>Moraine Park Campground<br>Latitude: 40.36066149616986<br>Longitude: -105.60006623223796<br><img
                    height="75"
                    src="https://www.nps.gov/common/uploads/structured_data/B5A3E6C5-1DD8-B71B-0B6729586EA1B95F.jpg">
            </li>
            <li>Timber Creek Campground<br>Latitude: 40.379225136469785<br>Longitude: -105.85275135737629<br><img
                    height="75"
                    src="https://www.nps.gov/common/uploads/structured_data/B60ED305-1DD8-B71B-0B6086EAB0EA124A.jpg">
            </li>
        </ul>
    </main>
</body>
<script type="text/javascript">
    $(function () {

        window.nps_data = [];
        let nps_query = 'https://developer.nps.gov/api/v1/campgrounds?limit=800&api_key=n9ZtO9IBzmlj5LnxQQ1WWSUaPbniCC1eIPJUIX0F';
        fetch(nps_query)
            .then(function (response) { return response.json() })
            .then(function (data) {
                window.nps_data = data;
            });

        $('#mapbox_form').submit(function (e) {
            e.preventDefault();

            let query = 'https://api.mapbox.com/geocoding/v5/mapbox.places/' + $('#mapbox_search').val().trim() + '.json?access_token=pk.eyJ1IjoiYmluZGVyYiIsImEiOiJjbDh5aDB4YmMwZ2hkM3VubjYxNnkzOGU5In0.-VmsT6OjBY12TuPgeei8bQ';
            fetch(query)
                .then(function (response) { return response.json() })
                .then(function (data) {
                    let s = '';
                    $('#results').empty();
                    if (data.features.length == 0) {
                        s += 'Sorry, no results returned.';
                    } else {
                        let filtered_nps = window.nps_data.data.filter(e =>
                            parseFloat(e.longitude) >= parseFloat(data.features[0].center[0]) - 1 &&
                            parseFloat(e.longitude) <= parseFloat(data.features[0].center[0]) + 1 &&
                            parseFloat(e.latitude) >= parseFloat(data.features[0].center[1]) - 1 &&
                            parseFloat(e.latitude) <= parseFloat(data.features[1].center[1]) + 1
                        );

                        s += 'Place returned: ' + data.features[0].place_name + '<br/>';
                        s += 'Latitude: ' + data.features[0].center[1] + '<br/>';
                        s += 'Longitude: ' + data.features[0].center[0] + '<br/>';
                        s += 'Campgrounds within 1 degree latitude/longitude: ';

                        if (filtered_nps.length > 0) {
                            s += '<ul>';
                            for (var i = 0; i < filtered_nps.length; i++) {
                                s += '<li>';
                                s += filtered_nps[i].name + '<br/>';
                                s += 'Latitude: ' + filtered_nps[i].latitude + '<br/>';
                                s += 'Longitude: ' + filtered_nps[i].longitude + '<br/>';
                                if (filtered_nps[i].images.length > 0) {
                                    s += '<img height="75" src="' + filtered_nps[i].images[0].url + '"/>';
                                } else {
                                    s += '(no image available)';
                                }
                                s += '</li>';
                            }
                            s += '</ul>';
                        } else {
                            s += 'No campgrounds found within 1 degree latitude/longitude.';
                        }


                    }

                    $('#results').append(s);


                });
        });
        // $('#nps_form').submit( function(e) {
        //   e.preventDefault();

        //   let query = 'https://developer.nps.gov/api/v1/campgrounds?stateCode='+$('#nps_search').val().trim()+'&api_key=n9ZtO9IBzmlj5LnxQQ1WWSUaPbniCC1eIPJUIX0F';
        //   // let query = 'https://developer.nps.gov/api/v1/campgrounds?parkCode=voya&api_key=n9ZtO9IBzmlj5LnxQQ1WWSUaPbniCC1eIPJUIX0F';

        //   fetch(query)
        //   .then(function(response) {return response.json()})
        //   .then(function(data) {
        //     let s = '';
        //     $('#results').empty();
        //     console.log(data.data);
        //     for (var i=0;i<data.data.length;i++) {
        //       s += '<li>';
        //       s += data.data[i].name + '<br/>';
        //       s += 'latitude: '+data.data[i].latitude + '<br/>';
        //       s += 'longitude: '+data.data[i].longitude + '<br/>';
        //       if (data.data[i].images.length > 0) {
        //         s += '<img width="100" src="'+data.data[i].images[0].url+'"/>';
        //       } else {
        //         s += '(no image available)';
        //       }
        //       s += '</li>';
        //     }
        //     $('#results').append(s);


        //   });
        // });
    });
</script>

</html>